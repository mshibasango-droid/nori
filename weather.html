<section class="section">
  <h2>当日の1時間ごとの予報（森山港周辺）</h2>

  <!-- ここにJSがテーブルを生成します -->
  <div id="hourlyWrap" class="card">
    <p class="small" id="hourlyNote">読み込み中…（数秒かかることがあります）</p>
    <div style="overflow:auto; border-radius:12px; border:1px solid var(--bd);">
      <table id="hourlyTable" style="width:100%; border-collapse:separate; border-spacing:0 6px; display:none">
        <thead>
          <tr>
            <th style="padding:8px 10px; background:#10283d; text-align:left">時刻</th>
            <th style="padding:8px 10px; background:#10283d; text-align:left">天気</th>
            <th style="padding:8px 10px; background:#10283d; text-align:right">気温(°C)</th>
            <th style="padding:8px 10px; background:#10283d; text-align:right">降水量(mm)</th>
            <th style="padding:8px 10px; background:#10283d; text-align:right">降水確率(%)</th>
            <th style="padding:8px 10px; background:#10283d; text-align:right">風(m/s)</th>
            <th style="padding:8px 10px; background:#10283d; text-align:right">突風(m/s)</th>
            <th style="padding:8px 10px; background:#10283d; text-align:right">風向</th>
          </tr>
        </thead>
        <tbody id="hourlyBody"></tbody>
      </table>
    </div>
    <p class="small" style="margin-top:6px">
      出典：<a href="https://open-meteo.com/" target="_blank" rel="noopener">Open-Meteo</a>（無料API／非ログイン）。時刻は Asia/Tokyo（日本時間）。
    </p>
  </div>
</section>

<!-- ↓ この下に、前回の“天気サイト比較ビュー（タブ切替）”を続けて置いてOKです -->

<script>
  // 森山港付近
  const LAT = 35.5405, LON = 133.2058;
  // Open-Meteo（今日の24時間ぶん）
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}`
    + `&hourly=temperature_2m,precipitation,precipitation_probability,wind_speed_10m,wind_gusts_10m,wind_direction_10m,weathercode`
    + `&timezone=Asia%2FTokyo`;

  const WMO = {
    0:"快晴",1:"晴れ",2:"一時くもり",3:"くもり",
    45:"霧",48:"着氷性霧",
    51:"霧雨(弱)",53:"霧雨(中)",55:"霧雨(強)",
    61:"雨(弱)",63:"雨(中)",65:"雨(強)",
    66:"着氷雨(弱)",67:"着氷雨(強)",
    71:"雪(弱)",73:"雪(中)",75:"雪(強)",
    77:"雪あられ",
    80:"にわか雨(弱)",81:"にわか雨(中)",82:"にわか雨(強)",
    85:"にわか雪(弱)",86:"にわか雪(強)",
    95:"雷雨",96:"雷雨(雹小)",99:"雷雨(雹大)"
  };

  function degToDir(d){
    const dirs=["北","北北東","北東","東北東","東","東南東","南東","南南東","南","南南西","南西","西南西","西","西北西","北西","北北西"];
    return dirs[Math.round(d/22.5)%16] + ` (${Math.round(d)}°)`;
  }

  function fmt(n, digits=1){ return (n===null || n===undefined) ? "-" : Number(n).toFixed(digits); }

  (async function loadHourly(){
    const note = document.getElementById('hourlyNote');
    const table = document.getElementById('hourlyTable');
    const body = document.getElementById('hourlyBody');

    try{
      const res = await fetch(url, {cache:"no-store"});
      if(!res.ok) throw new Error("APIエラー");
      const d = await res.json();
      const now = new Date();
      const todayStr = now.toISOString().slice(0,10); // YYYY-MM-DD
      const times = d.hourly.time; // ISO文字列（日本時間）
      const idxToday = times.map((t,i)=> t.startsWith(todayStr) ? i : -1).filter(i=>i>=0);

      // 今日の今の時刻以降〜24:00まで
      const startIdx = idxToday.find(i => new Date(times[i]).getHours() >= now.getHours()) ?? idxToday[0];
      const rows = idxToday.filter(i => i >= startIdx);

      // もし深夜を跨いで早朝を見たい場合は、必要ならここで rows を次の日の数時間分まで拡張可

      body.innerHTML = "";
      rows.forEach(i=>{
        const t = new Date(times[i]);
        const hh = String(t.getHours()).padStart(2,"0")+":00";
        const wc = d.hourly.weathercode[i];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td style="padding:8px 10px; background:rgba(255,255,255,.03)">${hh}</td>
          <td style="padding:8px 10px; background:rgba(255,255,255,.03)">${WMO[wc] ?? "—"}</td>
          <td style="padding:8px 10px; background:rgba(255,255,255,.03); text-align:right">${fmt(d.hourly.temperature_2m[i],0)}</td>
          <td style="padding:8px 10px; background:rgba(255,255,255,.03); text-align:right">${fmt(d.hourly.precipitation[i],1)}</td>
          <td style="padding:8px 10px; background:rgba(255,255,255,.03); text-align:right">${fmt(d.hourly.precipitation_probability?.[i] ?? null,0)}</td>
          <td style="padding:8px 10px; background:rgba(255,255,255,.03); text-align:right">${fmt(d.hourly.wind_speed_10m[i],1)}</td>
          <td style="padding:8px 10px; background:rgba(255,255,255,.03); text-align:right">${fmt(d.hourly.wind_gusts_10m?.[i] ?? null,1)}</td>
          <td style="padding:8px 10px; background:rgba(255,255,255,.03); text-align:right">${degToDir(d.hourly.wind_direction_10m[i])}</td>
        `;
        body.appendChild(tr);
      });

      table.style.display = "";
      note.textContent = `更新：${todayStr} 現在の時刻以降を表示（地点: ${LAT.toFixed(3)} / ${LON.toFixed(3)}）。`;
    }catch(e){
